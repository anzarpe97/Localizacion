<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="report_invoice_template_dual">
        <t t-name="forma_libre.report_invoice_template_dual">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                <html lang="es">
                <head>
					<meta charset="UTF-8" />
					<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
				</head>
                <body>
                    <main style="font-family: 'Open Sans', sans-serif;">

                        <!-- Datos del Cliente y Factura -->
                        <table style="width: 100%; margin-bottom: 5px;">
                            <tr>
                                <!-- Columna del Cliente -->
                                <td style="width: 50%; vertical-align: top; padding-right: 10px; font-size: 9px;">
                                    <p><strong>Cliente:</strong> <t t-esc="doc.partner_id.name or ''"/></p>
                                    <p><strong>R.I.F:</strong> <t t-esc="doc.partner_id.vat or ''"/></p>
                                    <p><strong>DOMICILIO FISCAL:</strong> <t t-esc="doc.partner_id.contact_address or ''"/></p>
                                    <p><strong>E-MAIL:</strong> <t t-esc="doc.partner_id.email or ''"/></p>
                                    <p><strong>TELÉFONO:</strong> <t t-esc="doc.partner_id.phone or ''"/></p>
                                </td>
                                <!-- Columna de Factura -->
                                <td style="width: 50%; text-align: right; vertical-align: top; font-size: 9px;">
                                    <p>
                                        <strong>
                                            <t t-if="doc.move_type == 'out_invoice'">
                                            <t t-if="doc.debit_origin_id">Nota de Débito:</t>
                                            <t t-else=""><span>Número de Factura:</span></t>
                                            </t>
                                            <t t-elif="doc.move_type == 'out_refund'">Nota de Crédito:</t>
                                        </strong>
                                        <t t-esc="doc.name or ''"/>
                                    </p>

                                    <!-- Documento Afectado -->
                                    <t t-if="doc.move_type == 'out_refund' and doc.reversed_entry_id">
                                        <p><strong>Documento Afectado:</strong> <t t-esc="doc.reversed_entry_id.name"/></p>
                                    </t>
                                    <t t-if="doc.move_type == 'out_refund' and doc.reversed_entry_id">
                                        <p><strong>Fecha de Documento Afectado:</strong> <t t-esc="doc.reversed_entry_id.date.strftime('%d/%m/%Y')"/></p>
                                    </t>
                                    <t t-if="doc.move_type == 'out_invoice' and doc.debit_origin_id">
                                        <p><strong>Documento Afectado:</strong> <t t-esc="doc.debit_origin_id.name"/></p>
                                    </t>
                                    <t t-if="doc.move_type == 'out_invoice' and doc.debit_origin_id">
                                        <p><strong>Fecha de Documento Afectado:</strong> <t t-esc="doc.debit_origin_id.date.strftime('%d/%m/%Y')"/></p>
                                    </t>

                                    <p><strong>Fecha:</strong> <t t-esc="doc.invoice_date.strftime('%d/%m/%Y') if doc.invoice_date else ''"/></p>
                                    <p><strong>Termino de Pago:</strong> <t t-esc="doc.invoice_payment_term_id.name or ''"/></p>
                                </td>
                            </tr>
                        </table>

                        <!-- Tabla de Productos -->
                        <table class="table table-sm" style="width: 100%; border-collapse: collapse; font-size: 9px;">
                                <thead>
                                    <tr>
                                        <th style="text-align: center; width: 5%;">ITEM</th>
                                        <t t-if="any(line.product_id and line.product_id.default_code for line in doc.invoice_line_ids)">
                                            <th style="text-align: left; width: 10%;">CODIGO</th>
                                        </t>
                                        <th style="text-align: left;">DESCRIPCIÓN</th>
                                        <th style="text-align: center; width: 8%;">UNID.</th>
                                        <th style="text-align: right; width: 8%;">CANT.</th>
                                        <th style="text-align: right; width: 10%;">PRECIO UNITARIO</th>
                                         <t t-if="any(line.discount and line.discount != 0 for line in doc.invoice_line_ids)">
                                            <th style="text-align: center; width: 8%;">DSCTO %</th>
                                        </t>
                                        <th style="text-align: right; width: 12%;">VALOR TOTAL</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr t-foreach="doc.invoice_line_ids" t-as="line" style="vertical-align: top;">
                                    <!-- ITEM -->
                                    <td style="border: none; text-align: center; font-size: 9px; vertical-align: top;">
                                        <span t-esc="line_index + 1"/>
                                    </td>
                                    <!-- Código solo si existe -->
                                    <t t-if="any(l.product_id and l.product_id.default_code for l in doc.invoice_line_ids)">
                                        <td style="border: none; text-align: left; font-size: 9px; vertical-align: top;">
                                            <t t-if="line.product_id and line.product_id.default_code">
                                                <t t-esc="line.product_id.default_code"/>
                                            </t>
                                        </td>
                                    </t>

                                    <!-- Producto con descripción incluida -->
                                    <td style="border: none; text-align: left; font-size: 9px;">
                                        <t t-esc="line.product_id.name or ''"/>
                                        <t t-if="line.name and line.name.strip() != (line.product_id.name or '').strip()">
                                            <br/>
                                            <span style="font-size: 8px;">
                                                <t t-esc="line.name"/>
                                            </span>
                                        </t>
                                        <t t-if="line.alicuota">
                                            <span> <t t-esc="line.alicuota"/></span>
                                        </t>
                                    </td>

                                    <!-- UNIDAD -->
                                    <td style="border: none; text-align: center; font-size: 9px; vertical-align: top;">
                                        <span t-esc="line.product_uom_id.name or ''"/>
                                    </td>

                                    <td style="border: none; text-align: right; font-size: 9px; vertical-align: top;">
                                        <t t-esc="'%0.2f' % (line.quantity or 0.0)"/>
                                    </td>
                                    <td style="border: none; text-align: right; font-size: 9px; vertical-align: top;">
                                        <t t-esc="'{:,.2f}'.format(line.price_unit).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                    </td>
                                    <t t-if="any(l.discount and l.discount != 0 for l in doc.invoice_line_ids)">
                                    <td style="border: none; text-align: center; font-size: 9px; vertical-align: top;">
                                    <t t-esc="line.discount if line.discount != 0 else ''"/>
                                    </td>
                                     </t>

                                    <td style="border: none; text-align: right; font-size: 9px; vertical-align: top;">
                                        <t t-esc="'{:,.2f}'.format(line.price_subtotal).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

    
                        <!-- Bloque de Montos en Bolívares y Dólares -->
                        <div style="position: fixed; top: 440px; width: 95%; text-align: center; font-size: 9px; border: 1px solid black; padding: 10px;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 9px;">
                                <thead>
                                    <tr>
                                        <th colspan="2" style="border-right: 1px solid black;">Monto en Bolívares (Bs.)</th>
                                        <th colspan="2">Monto en Dólares (US$.)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Sub-Total -->
                                    <tr>
                                        <td><strong>Sub-Total:</strong></td>
                                        <td style="border-right: 1px solid black; text-align: right; padding-right: 10px;">
                                            <t t-esc="'{:,.2f}'.format((doc.total_imponible or 0.0) + (doc.tax_exento or 0.0)).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                        </td>
                                        <td><strong>Sub-Total Ref:</strong></td>
                                        <td style="text-align: right;">
                                            <t t-esc="'{:,.2f}'.format((doc.total_imponible_usd or 0.0) + (doc.tax_exento_usd or 0.0)).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                        </td>
                                    </tr>



                                    <!-- Base Imponible -->
                                    <tr>
                                        <td><strong>Base Imponible:</strong></td>
                                        <td style="border-right: 1px solid black; text-align: right; padding-right: 10px;">
                                            <t t-esc="'{:,.2f}'.format(doc.total_imponible or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                        </td>
                                        <td><strong>Base Imponible Ref:</strong></td>
                                        <td style="text-align: right;">
                                            <t t-esc="'{:,.2f}'.format(doc.total_imponible_usd or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                        </td>
                                    </tr>

                                    <!-- Total Exento -->
                                    <tr>
                                            <td><strong>Total Exento:</strong></td>
                                            <td style="border-right: 1px solid black; text-align: right; padding-right: 10px;">
                                                <t t-esc="'{:,.2f}'.format(doc.tax_exento or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                            </td>
                                            <td><strong>Total Exento Ref:</strong></td>
                                            <td style="text-align: right;">
                                                <t t-esc="'{:,.2f}'.format(doc.tax_exento_usd or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                            </td>
                                    </tr>

                                    <!-- IVA 8% -->
                                    <t t-if="doc.tax_8 != 0 or doc.tax_8_usd != 0">
                                        <tr>
                                            <td>
                                                <strong>IVA 8% Sobre 
                                                    <t t-esc="'{:,.2f}'.format(doc.base_8 or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/> :
                                                </strong>
                                            </td>
                                            <td style="border-right: 1px solid black; text-align: right; padding-right: 10px;">
                                                <t t-esc="'{:,.2f}'.format(doc.tax_8 or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                            </td>
                                            <td>
                                                <strong>IVA 16% Ref Sobre 
                                                    <t t-esc="'{:,.2f}'.format(doc.base_8_usd or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>:
                                                </strong>
                                            </td>
                                            <td style="text-align: right;">
                                                <t t-esc="'{:,.2f}'.format(doc.tax_8_usd or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                            </td>
                                        </tr>
                                    </t>

                                    <!-- IVA 16% -->
                                    <t t-if="doc.tax_16 != 0 or doc.tax_16_usd != 0">
                                        <tr>
                                            <td>
                                                <strong>IVA 16% Sobre 
                                                    <t t-esc="'{:,.2f}'.format(doc.base_16 or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/> :
                                                </strong>
                                            </td>
                                            <td style="border-right: 1px solid black; text-align: right; padding-right: 10px;">
                                                <t t-esc="'{:,.2f}'.format(doc.tax_16 or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                            </td>
                                            <td>
                                                <strong>IVA 16% Ref Sobre 
                                                    <t t-esc="'{:,.2f}'.format(doc.base_16_usd or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>:
                                                </strong>
                                            </td>
                                            <td style="text-align: right;">
                                                <t t-esc="'{:,.2f}'.format(doc.tax_16_usd or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                            </td>
                                        </tr>
                                    </t>


                                    <!-- IVA 31% -->
                                    <t t-if="doc.tax_31 != 0 or doc.tax_31_usd != 0">
                                        <tr>
                                            <td>
                                                <strong>IVA 15% + 16% Sobre 
                                                    <t t-esc="'{:,.2f}'.format(doc.base_31 or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/> :
                                                </strong>
                                            </td>
                                            <td style="border-right: 1px solid black; text-align: right; padding-right: 10px;">
                                                <t t-esc="'{:,.2f}'.format(doc.tax_31 or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                            </td>
                                            <td>
                                                <strong>IVA 15% + 16% Ref Sobre 
                                                    <t t-esc="'{:,.2f}'.format(doc.base_31_usd or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>:
                                                </strong>
                                            </td>
                                            <td style="text-align: right;">
                                                <t t-esc="'{:,.2f}'.format(doc.tax_31_usd or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                            </td>
                                        </tr>
                                    </t>

                                    <!-- Total General -->
                                    <tr>
                                        <td><strong>Valor Total Bs.:</strong></td>
                                        <td style="border-right: 1px solid black; text-align: right; padding-right: 10px;">
                                            <t t-esc="'{:,.2f}'.format(doc.amount_total or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                        </td>
                                        <td><strong>Valor Total Ref:</strong></td>
                                        <td style="text-align: right;">
                                            <t t-esc="'{:,.2f}'.format(doc.amount_total_usd or 0.0).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td colspan="4" style="text-align: left; padding-top: 10px;">
                                            <p style="margin: 0;"><strong>
                                                En caso de pagar la totalidad de la factura o porción con moneda extranjera, se cobrará el 3% de IGTF según Gaceta Oficial 42.339 de fecha 25/02/2022
                                            </strong></p>

                                            <p style="margin: 0; margin-top: 8px;"><strong>
                                                Tasa Vigente al <span t-field="doc.invoice_date" t-options='{"widget": "date", "format": "dd/MM/yyyy"}'/> según el BCV:
                                                <span t-field="doc.tax_today" t-options='{"widget": "float", "precision": 4}'/>
                                            </strong></p>
                                            
                                            <hr style="margin: 10px 0;" />
                                            <p style="margin: 0;">
                                                FACTURA SEGUN CONVENIO CAMBIARIO N°1 GOE N°6.405 DE FECHA 07/09/2018. FACTURA CALCULADA A LA TASA BCV ACTUAL Bs. POR US$
                                                DOLAR <span t-field="doc.tax_today" t-options='{"widget": "float", "precision": 4}'/> PARA EFECTOS DEL IVA DE CONFORMIDAD CON LO ESTABLECIDO EN EL ARTICULO 116 DEL BCV.
                                                PAGARA EN BOLIVARES A LA TASA BCV DEL DIA.
                                            </p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- Indicador Original o Copia -->
                        <div style="width: 100%; text-align: center; margin-top: 20px; font-size: 12px; position: relative;">
                            <t t-if="doc.print_count > 1">
                                <div style="
                                    position: absolute;
                                    top: 120px; /* Centrado vertical */
                                    left: 108px; /* Centrado horizontal */
                                    transform: translate(-50%, -50%); /* Ajuste de posición */
                                    font-size: 16px;
                                    color: rgba(255, 0, 0, 0.07);
                                    font-weight: 900;
                                    z-index: -1;
                                    white-space: nowrap;
                                    pointer-events: none;
                                    text-align: center;
                                ">
                                    REIMPRESIÓN - SIN DERECHO A CRÉDITO FISCAL
                                </div>
                            </t>
                            <t t-else=""/>
                        </div>

                    </main>
                </body>
            </html>
        </t>
    </t>
</t>
</template>
</odoo>